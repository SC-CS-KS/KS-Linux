# rpm

rpm 命令

在Linux操作系统中，有一个系统软件包，功能类似于Windows里面的“添加/删除程序”。
但是功能又比“添加/删除程序”强很多，它就是Red Hat Package Manager(简称RPM)。
此工具包最先是由Red Hat公司推出的，后来被其他Linux开发商所借用。
由于它为Linux使用者省去了很多时间，所以被广泛应用于在Linux下安装、删除软件。
---------------------------------------------------------------------------------------------------------------
01.我们得到一个新软件，在安装之前，一般都要先查看一下这个软件包里有什么内容.
假设这个文件是：Linux-1.4-6.i368.rpm，我们可以用这条命令查看：
　　rpm -qpi Linux-1.4-6.i368.rpm
  系统将会列出这个软件包的详细资料，包括含有多少个文件、各文件名称、文件大小、创建时间、编译日期等信息。
---------------------------------------------------------------------------------------------------------------
02.上面列出的所有文件在安装时不一定全部安装，就像Windows下程序的安装方式分为典型、完全、自定义一样.
Linux也会让你选择安装方式。此时我们可以用下面这条命令查看软件包将会在系统里安装哪些部分，以方便我们的选择：
　　rpm -qpl Linux-1.4-6.i368.rpm
---------------------------------------------------------------------------------------------------------------
03.选择安装方式后，开始安装。我们可以用rpm-ivh Linux-1.4-6.i368.rpm命令安装此软件。
在安装过程中，若系统提示此软件已安装过或因其他原因无法继续安装。
但若我们确实想执行安装命令，可以在 -ivh后加一参数“-replacepkgs”：
　　rpm -ivh -replacepkgs Linux-1.4-6.i368.rpm
---------------------------------------------------------------------------------------------------------------
04.有时我们卸载某个安装过的软件，只需执行rpm-e <文件名>命令即可。
---------------------------------------------------------------------------------------------------------------
05.对低版本软件进行升级是提高其功能的好办法，这样可以省去我们卸载后再安装新软件的麻烦，要升级某个软件，只须执行如下命令：
        rpm -uvh <文件名>
    注意：此时的文件名必须是要升级软件的升级补丁
---------------------------------------------------------------------------------------------------------------
06.另外一个安装软件的方法可谓是Linux的独到之处，同时也是RMP强大功能的一个表现：通过FTP站点直接在线安装软件。
   当找到含有你所需软件的站点并与此网站连接后，执行下面的命令即可实现在线安装，譬如在线安装Linux-1.4-6.i368.rpm，可以用命令：
　　rpm -i ftp://ftp.pht.com/pub/linux/redhat/...-1.4-6.i368.rpm
---------------------------------------------------------------------------------------------------------------
07.在我们使用电脑过程中，难免会有误操作，若我们误删了几个文件而影响了系统的性能时，怎样查找到底少了哪些文件呢?
  RPM软件包提供了一个查找损坏文件的功能，执行此命令：
        rpm -Va即可，Linux将为你列出所有损坏的文件。你可以通过Linux的安装光盘进行修复。
---------------------------------------------------------------------------------------------------------------
08.Linux系统中文件繁多，在使用过程中，难免会碰到我们不认识的文件。
在Windows下我们可以用“开始/查找”菜单快速判断某个文件属于哪个文件夹。
在Linux中，下面这条命令行可以帮助我们快速判定某个文件属于哪个软件包：
　　rpm -qf <文件名>
---------------------------------------------------------------------------------------------------------------
09.当每个软件包安装在Linux系统后，安装文件都会到RPM数据库中“报到”。
所以，我们要查询某个已安装软件的属性时，只需到此数据库中查找即可。
注意：此时的查询命令不同于1和8介绍的查询，这种方法只适用于已安装过的软件包！命令格式：
　　rpm -参数　<文件名>
---------------------------------------------------------------------------------------------------------------
常用参数：
Install/Upgrade/Erase options:
-i, --install                         install package(s)
-v, --verbose                     provide more detailed output
-h, --hash                         print hash marks as package installs (good with -v)
-e, --erase                        erase (uninstall) package
-U, --upgrade=<packagefile>+      upgrade package(s)
--replacepkge                 无论软件包是否已被安装，都强行安装软件包
--test                                安装测试，并不实际安装
--nodeps                         忽略软件包的依赖关系强行安装
--force                             忽略软件包及文件的冲突

Query options (with -q or --query):
-a, --all                         query/verify all packages
-p, --package              query/verify a package file
-l, --list                         list files in package
-d, --docfiles                list all documentation files
-f, --file                        query/verify package(s) owning file
---------------------------------------------------------------------------------------------------------------


rpm 应用

RPM源代码包装安装
.src.rpm结尾的文件，这些文件是由软件的源代码包装而成的，用户要安装这类RPM软件包，必须使用命令：
rpm　--recompile　vim-4.6-4.src.rpm   #这个命令会把源代码解包并编译、安装它，如果用户使用命令：
rpm　--rebuild　vim-4.6-4.src.rpm　　 #在安装完成后，还会把编译生成的可执行文件重新包装成i386.rpm的RPM软件包。
---------------------------------------------------------------------------------------------------------------
RPM包里面都包含什么？
里面包含可执行的二进制程序，这个程序和Windows的软件包中的.exe文件类似是可执行的。
RPM包中还包括程序运行时所需要的文件，这也和Windows的软件包类似，Windows的程序的运行，除了.exe文件以外，也有其它的文件。
一个RPM 包中的应用程序，有时除了自身所带的附加文件保证其正常以外，还需要其它特定版本文件，这就是软件包的依赖关系。
---------------------------------------------------------------------------------------------------------------
本文使用范围：
1、本文是对RPM管理的软件的说明，对通过file.tar.gz 或file.tar.bz2源码包用 make ;make install 安装的软件无效
2、安装软件时，最好用各自发行版所提供的系统软件包管理工具，对于Fedora/Redhat 您可以参考如下文章
1）Fedora 系统管理软件包工具 system-config-packages，方便的添加和移除系统安装盘提供的软件包，详情请看 《Fedora 软件包管理器system-config-packages》
2）Redhat 系统管理软件包工具,新一点的系统应该是 redhat-config-packages ，用法和 《Fedora 软件包管理器system-config-packages》 一样
3）apt + synaptic 软件包在线安装、移除、升级工具； 用法：《用apt+synaptic 在线安装或升级Fedora core 4.0 软件包》
4）yum 软件包在线安装、升级、移除工具；用法：《Fedora/Redhat 在线安装更新软件包，yum 篇》
5）所有的yum和apt 教程 《apt and yum》

目前 apt和yum 已经极为成熟了，建议我们安装软件时，采用 apt或者yum。
如果安装系统盘提供的软件包，可以用 system-config-packages 或redhat-config-packages。
---------------------------------------------------------------------------------------------------------------
01.RPM包管理的用途；
1、可以安装、删除、升级和管理软件；当然也支持在线安装和升级软件
2、通过RPM包管理能知道软件包包含哪些文件，也能知道系统中的某个文件属于哪个软件包
3、可以在查询系统中的软件包是否安装以及其版本
4、作为开发者可以把自己的程序打包为RPM 包发布
5、软件包签名GPG和MD5的导入、验证和签名发布
6、依赖性的检查，查看是否有软件包由于不兼容而扰乱了系统
---------------------------------------------------------------------------------------------------------------
02.RPM 的使用权限；
RPM软件的安装、删除、更新只有root权限才能使用。
对于查询功能任何用户都可以操作。
如果普通用户拥有安装目录的权限，也可以进行安装。
---------------------------------------------------------------------------------------------------------------
03.rpm 的一点简单用法
我们除了软件包管理器以外，还能通过rpm 命令来安装。

是不是所有的软件包都能通过rpm 命令来安装呢？
不是的，文件以.rpm 后缀结尾的才行，有时我们在一些网站上找到file.rpm ，都要用 rpm 来安装。

3.1.初始化rpm 数据库
通过rpm 命令查询一个rpm 包是否安装了，也是要通过rpm 数据库来完成的，所以我们要经常用下面的两个命令来初始化rpm 数据库。
# rpm --initdb
# rpm --rebuilddb 注：这个要花好长时间
注：这两个参数是极为有用，有时rpm 系统出了问题，不能安装和查询，大多是这里出了问题。

3.2.RPM软件包管理的查询功能
命令格式
rpm {-q|--query} [select-options] [query-options]
RPM的查询功能是极为强大，是极为重要的功能之一，举几个常用的例子，更为详细的具体的，请参考#man rpm

3.2.1.对系统中已安装软件的查询
1）查询系统已安装的软件；
语法：rpm -q 软件名
举例：
# rpm -q gaim
gaim-1.3.0-1.fc4
-q就是 --query ，中文意思是“问”，此命令表示的是，是不是系统安装了gaim 。如果已安装会有信息输出，如果没有安装，会输出gaim 没有安装的信息。
查看系统中所有已经安装的包，要加 -a 参数。
# rpm -qa
----------------------------------------------------------
2）查询一个已经安装的文件属于哪个软件包 
语法 rpm -qf 文件名
注：文件名所在的绝对路径要指出
举例：
# rpm -qf /usr/lib/libacl.la
libacl-devel-2.2.23-8
----------------------------------------------------------
3）查询已安装软件包都安装到何处
语法：rpm -ql 软件名 或 rpm rpmquery -ql 软件名
举例：
# rpm -ql lynx
# rpmquery -ql lynx
----------------------------------------------------------
4）查询一个已安装软件包的信息
语法格式： rpm -qi 软件名
举例：
# rpm -qi lynx
----------------------------------------------------------
5）查看一下已安装软件的配置文件
语法格式：rpm -qc 软件名
举例：
# rpm -qc lynx
----------------------------------------------------------
6）查看一个已经安装软件的文档安装位置
语法格式： rpm -qd 软件名
举例：
# rpm -qd lynx
----------------------------------------------------------
7）查看一下已安装软件所依赖的软件包及文件
语法格式： rpm -qR 软件名
举例：
# rpm -qR rpm-python
----------------------------------------------------------
查询已安装软件的总结：对于一个软件包已经安装，我们可以把一系列的参数组合起来用。
比如 rpm -qil ，比如：
# rpm -qil lynx
----------------------------------------------------------
3.2.2.对于未安装的软件包的查看：
查看的前提是您有一个.rpm 的文件，也就是说对既有软件file.rpm的查看等；
1）查看一个软件包的用途、版本等信息；
语法： rpm -qpi file.rpm
举例：
# rpm -qpi lynx-2.8.5-23.i386.rpm
----------------------------------------------------------
2）查看一件软件包所包含的文件
语法： rpm -qpl file.rpm
举例：
# rpm -qpl lynx-2.8.5-23.i386.rpm
----------------------------------------------------------
3）查看软件包的文档所在的位置 
语法： rpm -qpd file.rpm
举例：
# rpm -qpd lynx-2.8.5-23.i386.rpm
----------------------------------------------------------
4）查看一个软件包的配置文件
语法： rpm -qpc file.rpm
举例：
# rpm -qpc lynx-2.8.5-23.i386.rpm
----------------------------------------------------------
5）查看一个软件包的依赖关系
语法： rpm -qpR file.rpm
举例：
# rpm -qpR yumex_0.42-3.0.fc4_noarch.rpm

3.3.软件包的安装、升级、删除等
3.3.1安装和升级一个rpm 包
#rpm -vih file.rpm 
注：这个是用来安装一个新的rpm 包
#rpm -Uvh file.rpm 注：这是用来升级一个rpm 包
如果有依赖关系的，请解决依赖关系，其实软件包管理器能很好的解决依赖关系，请看前面的软件包管理器的介绍。
如果您在软件包管理器中也找不到依赖关系的包，那只能通过编译他所依赖的包来解决依赖关系，或者强制安装。

语法结构：
# rpm -ivh file.rpm --nodeps --force
# rpm -Uvh file.rpm --nodeps --force

举例应用：
# rpm -ivh lynx-2.8.5-23.i386.rpm
Preparing... ########################################### [100%]
      1:lynx ########################################### [100%]

# rpm -ivh --replacepkgs lynx-2.8.5-23.i386.rpm
Preparing... ########################################### [100%]
      1:lynx ########################################### [100%]

注： --replacepkgs 参数是以已安装的软件再安装一次，有时没有太大的必要。
测试安装参数 --test ，用来检查依赖关系，并不是真正的安装。
# rpm -ivh --test gaim-1.3.0-1.fc4.i386.rpm
Preparing... ########################################### [100%]

由新版本降级为旧版本，要加 --oldpackage 参数。
# rpm -qa gaim
gaim-1.5.0-1.fc4
# rpm -Uvh --oldpackage gaim-1.3.0-1.fc4.i386.rpm
Preparing... ########################################### [100%]
      1:gaim ########################################### [100%]

# rpm -qa gaim
gaim-1.3.0-1.fc4

为软件包指定安装目录：要加 -relocate 参数。
下面的举例是把gaim-1.3.0-1.fc4.i386.rpm指定安装在 /opt/gaim 目录中
# rpm -ivh --relocate /=/opt/gaim gaim-1.3.0-1.fc4.i386.rpm
Preparing... ########################################### [100%]
      1:gaim ########################################### [100%]

# ls /opt/
gaim

我们安装在指定目录中的程序如何调用呢？
一般执行程序，都放在安装目录的bin或者sbin目录中。
看下面的例子，如果有错误输出，就做相应的链接，用 ln -s 。
 
# /opt/lynx/usr/bin/lynx
Configuration file /etc/lynx.cfg is not available.
# ln -s /opt/lynx/etc/lynx.cfg /etc/lynx.cfg
# /opt/lynx/usr/bin/lynx www.linuxsir.org

3.3.2.删除一个rpm 包
首先您要学会查询rpm 包 ，请看前面的说明。
#rpm -e 软件包名
举例：我想移除lynx 包，完整的操作应该是：
# rpm -e lynx
如果有依赖关系，您也可以用--nodeps 忽略依赖的检查来删除。
但尽可能不要这么做，最好用软件包管理器 systerm-config-packages 来删除或者添加软件。
# rpm -e lynx --nodeps
---------------------------------------------------------------------------------------------------------------
04.导入签名：
# rpm --import 签名文件
举例：
# rpm --import RPM-GPG-KEY
# rpm --import RPM-GPG-KEY-fedora
---------------------------------------------------------------------------------------------------------------
05.RPM管理包管理器支持网络安装和查询
比如我们想通过 Fedora Core 4.0 的一个镜像查询、安装软件包。
地址：
http://mirrors.kernel.org/fedora/core/4/i386/os/Fedora/RPMS/

举例：
rpm 参数 rpm包文件的http或者ftp的地址
# rpm -qpi http://mirrors.kernel.org/fedora/core/4/i386/os/ Fedora/RPMS/gaim-1.3.0-1.fc4.i386.rpm
# rpm -ivh http://mirrors.kernel.org/fedora/core/4/i386/os/ Fedora/RPMS/gaim-1.3.0-1.fc4.i386.rpm
---------------------------------------------------------------------------------------------------------------
06.对已安装软件包查询的一点补充
# updatedb
# locate 软件名或文件名

通过updatedb，我们可以用 locate 来查询一些软件安装到哪里了。
系统初次安装时要执行updatedb ，每隔一段时间也要执行一次。
以保持已安装软件库最新，updatedb 是slocate软件包所有，如果您没有这个命令，就得安装slocate。

举例：
# locate gaim
---------------------------------------------------------------------------------------------------------------
07.从rpm软件包抽取文件；
命令格式： rpm2cpio file.rpm |cpio -div
举例：
# rpm2cpio gaim-1.3.0-1.fc4.i386.rpm |cpio -div
抽取出来的文件就在当前操作目录中的 usr 和etc中。
其实这样抽到文件不如指定安装目录来安装软件来的方便，也一样可以抽出文件。
为软件包指定安装目录：要加 -relocate 参数，下面的举例是把gaim-1.3.0-1.fc4.i386.rpm指定安装在 /opt/gaim 目录中。
# rpm -ivh --relocate /=/opt/gaim gaim-1.3.0-1.fc4.i386.rpm
Preparing... ########################################### [100%]
      1:gaim ########################################### [100%]
# ls /opt/
gaim
这样也能一目了然，gaim的所有文件都是安装在 /opt/gaim 中，我们只是把gaim 目录备份一下，然后卸掉gaim。这样其实也算提取文件的一点用法。
---------------------------------------------------------------------------------------------------------------
08.RPM的配置文件
RPM包管理，的配置文件是 rpmrc ，我们可以在自己的系统中找到，比如Fedora Core 4.0中的rpmrc 文件位于。
# locate rpmrc
/usr/lib/rpm/rpmrc
/usr/lib/rpm/redhat/rpmrc
---------------------------------------------------------------------------------------------------------------
09.src.rpm的用法：
《file.src.rpm 使用方法的简介》
---------------------------------------------------------------------------------------------------------------
